import { AssignmentRule, AuditLogEntry, DashboardFilters, DashboardStateSnapshot, Epic, Issue, Sprint, TeamMember } from '../types';

const team: Record<string, TeamMember> = {
  'user-1': {
    id: 'user-1',
    name: 'Ana Gómez',
    email: 'ana@example.com',
    role: 'PM',
    title: 'Product Manager',
    timezone: 'America/Mexico_City',
    capacityPerSprint: 45,
    skills: ['Product', 'Discovery', 'Planning'],
    active: true,
    focusAreas: ['Prioritization', 'Stakeholder comms'],
  },
  'user-2': {
    id: 'user-2',
    name: 'Luis Fernández',
    email: 'luis@example.com',
    role: 'CONTRIBUTOR',
    title: 'Senior Frontend Engineer',
    timezone: 'America/Bogota',
    capacityPerSprint: 50,
    skills: ['React', 'TypeScript', 'UX'],
    active: true,
    focusAreas: ['Frontend', 'Design Systems'],
  },
  'user-3': {
    id: 'user-3',
    name: 'María Silva',
    email: 'maria@example.com',
    role: 'CONTRIBUTOR',
    title: 'Backend Engineer',
    timezone: 'America/Santiago',
    capacityPerSprint: 48,
    skills: ['Node.js', 'Prisma', 'Architectures'],
    active: true,
    focusAreas: ['APIs', 'Performance'],
  },
  'user-4': {
    id: 'user-4',
    name: 'Javier Ponce',
    email: 'javier@example.com',
    role: 'CONTRIBUTOR',
    title: 'QA Engineer',
    timezone: 'America/Lima',
    capacityPerSprint: 35,
    skills: ['Testing', 'Automation'],
    active: true,
    focusAreas: ['Quality', 'Tooling'],
  },
  'user-5': {
    id: 'user-5',
    name: 'Laura Méndez',
    email: 'laura@example.com',
    role: 'CONTRIBUTOR',
    title: 'Fullstack Engineer',
    timezone: 'Europe/Madrid',
    capacityPerSprint: 42,
    skills: ['React', 'Node.js', 'SQL'],
    active: true,
    focusAreas: ['Integrations', 'Delivery'],
  },
};

const sprints: Record<string, Sprint> = {
  'sprint-1': {
    id: 'sprint-1',
    name: 'Sprint 34',
    goal: 'MVP Kanban y Overview',
    status: 'ACTIVE',
    capacity: 130,
    startDate: '2024-04-01',
    endDate: '2024-04-14',
    projectId: 'project-1',
    issueIds: ['ST-101', 'ST-102', 'FE-201', 'BE-301'],
  },
  'sprint-2': {
    id: 'sprint-2',
    name: 'Sprint 35',
    goal: 'Automatizar priorización y asignación',
    status: 'PLANNED',
    capacity: 130,
    startDate: '2024-04-15',
    endDate: '2024-04-28',
    projectId: 'project-1',
    issueIds: ['ST-103', 'ST-104', 'FE-202', 'BE-302'],
  },
  'sprint-3': {
    id: 'sprint-3',
    name: 'Sprint 12',
    goal: 'Experiencia IA y reglas',
    status: 'ACTIVE',
    capacity: 120,
    startDate: '2024-04-01',
    endDate: '2024-04-14',
    projectId: 'project-2',
    issueIds: ['ST-201', 'FE-401'],
  },
};

const epics: Record<string, Epic> = {
  'EP-1': {
    id: 'EP-1',
    key: 'EP-1',
    name: 'Panel de Visibilidad Unificada',
    objective: 'Entrega visibilidad total a stakeholders sobre progreso',
    projectId: 'project-1',
    ownerId: 'user-1',
    status: 'IN_PROGRESS',
    storyIds: ['ST-101', 'ST-102', 'ST-103'],
    health: 'AT_RISK',
  },
  'EP-2': {
    id: 'EP-2',
    key: 'EP-2',
    name: 'Ingesta de Backlog en Markdown',
    objective: 'Importar backlog desde markdown con validaciones',
    projectId: 'project-1',
    ownerId: 'user-1',
    status: 'TODO',
    storyIds: ['ST-104'],
    health: 'ON_TRACK',
  },
  'EP-3': {
    id: 'EP-3',
    key: 'EP-3',
    name: 'Generación IA',
    objective: 'Normalizar historias con IA',
    projectId: 'project-2',
    ownerId: 'user-1',
    status: 'IN_PROGRESS',
    storyIds: ['ST-201'],
    health: 'ON_TRACK',
  },
};

const issues: Record<string, Issue> = {
  'ST-101': {
    id: 'ST-101',
    key: 'ST-101',
    title: 'Como stakeholder quiero ver KPIs del sprint actual',
    type: 'STORY',
    status: 'IN_PROGRESS',
    summary: 'KPIs principales (issues por estado, % completado, bloqueos) en overview',
    description: 'Diseñar tarjetas KPI con datos agregados por sprint, incluyendo bloqueos y porcentaje completado.',
    epicId: 'EP-1',
    assigneeId: 'user-2',
    reporterId: 'user-1',
    sprintId: 'sprint-1',
    storyPoints: 8,
    priority: 'HIGH',
    labels: ['overview', 'frontend'],
    dependencies: [],
    watchers: ['user-1'],
    blocked: false,
    acceptanceCriteria: [
      'Mostrar contador por estado (To Do, In Progress, Done)',
      'Calcular porcentaje completado del sprint',
      'Listar issues bloqueados con responsable',
    ],
    definitionOfDone: [
      'Validado con stakeholders',
      'Seguimiento en analytics básico',
    ],
    createdAt: '2024-03-10T08:00:00Z',
    updatedAt: '2024-03-20T10:00:00Z',
    comments: [
      {
        id: 'comment-1',
        authorId: 'user-1',
        message: 'Aseguremos soporte móvil básico.',
        createdAt: '2024-03-18T09:30:00Z',
      },
    ],
  },
  'ST-102': {
    id: 'ST-102',
    key: 'ST-102',
    title: 'Como PM quiero filtrar por proyecto y responsable',
    type: 'STORY',
    status: 'IN_REVIEW',
    summary: 'Agregar filtros combinados para overview',
    description: 'Permitir filtrar issues por proyecto, sprint, responsable, etiqueta y tipo.',
    epicId: 'EP-1',
    assigneeId: 'user-5',
    reporterId: 'user-1',
    sprintId: 'sprint-1',
    storyPoints: 5,
    priority: 'MEDIUM',
    labels: ['overview', 'filters'],
    dependencies: ['ST-101'],
    watchers: ['user-2'],
    blocked: false,
    acceptanceCriteria: [
      'Filtros combinables sin recargar página',
      'Persistir filtros en URL',
    ],
    definitionOfDone: [
      'QA smoke en navegadores principales',
      'Docs internas actualizadas',
    ],
    createdAt: '2024-03-12T08:00:00Z',
    updatedAt: '2024-03-22T13:00:00Z',
    comments: [],
  },
  'ST-103': {
    id: 'ST-103',
    key: 'ST-103',
    title: 'Como stakeholder quiero ver bloqueos destacados',
    type: 'STORY',
    status: 'TODO',
    summary: 'Sección de bloqueos críticos en overview',
    description: 'Listar issues bloqueados con responsables y fecha de actualización.',
    epicId: 'EP-1',
    assigneeId: 'user-4',
    reporterId: 'user-1',
    sprintId: 'sprint-2',
    storyPoints: 3,
    priority: 'MEDIUM',
    labels: ['overview', 'blocked'],
    dependencies: ['ST-101'],
    watchers: ['user-2'],
    blocked: true,
    acceptanceCriteria: [
      'Mostrar conteo de bloqueos',
      'Resaltar tarjetas en rojo',
      'Permitir marcar bloqueo resuelto',
    ],
    definitionOfDone: [
      'QA manual',
    ],
    createdAt: '2024-03-14T08:00:00Z',
    updatedAt: '2024-03-19T15:00:00Z',
    comments: [],
  },
  'ST-104': {
    id: 'ST-104',
    key: 'ST-104',
    title: 'Como PM quiero importar backlog en markdown',
    type: 'STORY',
    status: 'TODO',
    summary: 'Soporte para pegado/upload de markdown',
    description: 'Parsear markdown con IDs y convertirlo en árbol de épicas/historias/tareas.',
    epicId: 'EP-2',
    assigneeId: 'user-3',
    reporterId: 'user-1',
    sprintId: 'sprint-2',
    storyPoints: 8,
    priority: 'HIGH',
    labels: ['import', 'backend'],
    dependencies: [],
    watchers: ['user-1'],
    blocked: false,
    acceptanceCriteria: [
      'Validar IDs únicos',
      'Generar preview JSON',
      'Manejar archivos hasta 100k chars',
    ],
    definitionOfDone: [
      'Docs con formato soportado',
    ],
    createdAt: '2024-03-10T08:00:00Z',
    updatedAt: '2024-03-18T10:00:00Z',
    comments: [],
  },
  'FE-201': {
    id: 'FE-201',
    key: 'FE-201',
    title: 'Implementar layout principal del dashboard',
    type: 'TASK',
    subtype: 'FE',
    status: 'IN_PROGRESS',
    summary: 'Shell con sidebar, topbar y modo oscuro',
    description: 'Construir layout responsivo con navegación lateral, filtros y toasts.',
    epicId: 'EP-1',
    storyId: 'ST-101',
    assigneeId: 'user-2',
    reporterId: 'user-5',
    sprintId: 'sprint-1',
    storyPoints: 5,
    priority: 'HIGH',
    labels: ['frontend', 'layout'],
    dependencies: [],
    watchers: ['user-1'],
    blocked: false,
    acceptanceCriteria: [
      'Sidebar colapsable',
      'Layout accesible',
    ],
    definitionOfDone: [
      'Review de UX',
    ],
    createdAt: '2024-03-15T08:00:00Z',
    updatedAt: '2024-03-21T10:00:00Z',
    comments: [],
  },
  'FE-202': {
    id: 'FE-202',
    key: 'FE-202',
    title: 'Virtualizar backlog extenso',
    type: 'TASK',
    subtype: 'FE',
    status: 'TODO',
    summary: 'Virtual scrolling para listas grandes',
    description: 'Implementar virtualización cuando haya >200 items.',
    epicId: 'EP-2',
    storyId: 'ST-104',
    assigneeId: 'user-2',
    reporterId: 'user-3',
    sprintId: 'sprint-2',
    storyPoints: 5,
    priority: 'MEDIUM',
    labels: ['backend', 'performance'],
    dependencies: ['ST-104'],
    watchers: [],
    blocked: false,
    acceptanceCriteria: [],
    definitionOfDone: [],
    createdAt: '2024-03-20T08:00:00Z',
    updatedAt: '2024-03-20T08:00:00Z',
    comments: [],
  },
  'BE-301': {
    id: 'BE-301',
    key: 'BE-301',
    title: 'Preparar vistas materializadas para overview',
    type: 'TASK',
    subtype: 'BE',
    status: 'IN_PROGRESS',
    summary: 'Consultas agregadas por sprint y responsable',
    description: 'Crear consultas eficientes en Postgres + caché Redis para KPIs.',
    epicId: 'EP-1',
    storyId: 'ST-101',
    assigneeId: 'user-3',
    reporterId: 'user-1',
    sprintId: 'sprint-1',
    storyPoints: 8,
    priority: 'HIGH',
    labels: ['backend', 'performance'],
    dependencies: [],
    watchers: ['user-2'],
    blocked: true,
    acceptanceCriteria: [
      'Views materializadas actualizadas cada hora',
      'Indices por status, assigneeId, sprintId',
    ],
    definitionOfDone: ['Alerting básico configurado'],
    createdAt: '2024-03-16T08:00:00Z',
    updatedAt: '2024-03-21T08:00:00Z',
    comments: [
      {
        id: 'comment-2',
        authorId: 'user-3',
        message: 'Bloqueado esperando acceso a Redis.',
        createdAt: '2024-03-19T10:00:00Z',
      },
    ],
  },
  'BE-302': {
    id: 'BE-302',
    key: 'BE-302',
    title: 'Motor de priorización RICE',
    type: 'TASK',
    subtype: 'BE',
    status: 'TODO',
    summary: 'Endpoint que calcula RICE/WSJF',
    description: 'Recibir historias, devolver ranking y sugerir cortes por sprint.',
    epicId: 'EP-3',
    storyId: 'ST-201',
    assigneeId: 'user-3',
    reporterId: 'user-1',
    sprintId: 'sprint-2',
    storyPoints: 13,
    priority: 'CRITICAL',
    labels: ['planning', 'backend'],
    dependencies: ['ST-201'],
    watchers: [],
    blocked: false,
    acceptanceCriteria: [
      'Modo RICE y WSJF',
      'Respeta dependencias',
    ],
    definitionOfDone: ['Performance test con dataset grande'],
    createdAt: '2024-03-18T08:00:00Z',
    updatedAt: '2024-03-18T08:00:00Z',
    comments: [],
  },
  'ST-201': {
    id: 'ST-201',
    key: 'ST-201',
    title: 'Como PM quiero validar sugerencias IA',
    type: 'STORY',
    status: 'IN_PROGRESS',
    summary: 'Preview con diff original vs IA',
    description: 'Mostrar diffs de historias enriquecidas por IA con controles por lote.',
    epicId: 'EP-3',
    assigneeId: 'user-5',
    reporterId: 'user-1',
    sprintId: 'sprint-3',
    storyPoints: 5,
    priority: 'HIGH',
    labels: ['ai'],
    dependencies: [],
    watchers: ['user-2'],
    blocked: false,
    acceptanceCriteria: [
      'Diff con resaltado',
      'Aceptar por historia o lote',
    ],
    definitionOfDone: ['QA IA'],
    createdAt: '2024-03-11T08:00:00Z',
    updatedAt: '2024-03-19T08:00:00Z',
    comments: [],
  },
  'FE-401': {
    id: 'FE-401',
    key: 'FE-401',
    title: 'Diseñar vista de IA Preview',
    type: 'TASK',
    subtype: 'FE',
    status: 'IN_PROGRESS',
    summary: 'Comparar original vs IA con toggles',
    description: 'Interface con modos (conservador, balanceado, creativo).',
    epicId: 'EP-3',
    storyId: 'ST-201',
    assigneeId: 'user-5',
    reporterId: 'user-2',
    sprintId: 'sprint-3',
    storyPoints: 3,
    priority: 'MEDIUM',
    labels: ['ai', 'frontend'],
    dependencies: [],
    watchers: ['user-1'],
    blocked: false,
    acceptanceCriteria: [],
    definitionOfDone: [],
    createdAt: '2024-03-20T08:00:00Z',
    updatedAt: '2024-03-20T08:00:00Z',
    comments: [],
  },
};

const assignmentRules: Record<string, AssignmentRule> = {
  'rule-1': {
    id: 'rule-1',
    labelPattern: 'frontend',
    preferredRoles: ['CONTRIBUTOR'],
    preferredSkills: ['React'],
    fallbackAssigneeId: 'user-2',
  },
  'rule-2': {
    id: 'rule-2',
    labelPattern: 'backend',
    preferredRoles: ['CONTRIBUTOR'],
    preferredSkills: ['Node.js'],
    fallbackAssigneeId: 'user-3',
  },
};

const activity: AuditLogEntry[] = [
  {
    id: 'audit-1',
    actorId: 'user-2',
    action: 'status_changed',
    scope: 'ISSUE',
    targetId: 'FE-201',
    createdAt: '2024-03-21T10:00:00Z',
    payload: { from: 'TODO', to: 'IN_PROGRESS' },
  },
  {
    id: 'audit-2',
    actorId: 'user-3',
    action: 'comment_added',
    scope: 'ISSUE',
    targetId: 'BE-301',
    createdAt: '2024-03-19T10:00:00Z',
    payload: { message: 'Esperando acceso a Redis' },
  },
  {
    id: 'audit-3',
    actorId: 'user-1',
    action: 'sprint_created',
    scope: 'SPRINT',
    targetId: 'sprint-2',
    createdAt: '2024-03-15T09:00:00Z',
    payload: { capacity: 130 },
  },
];

export const defaultFilters: DashboardFilters = {
  projectId: 'project-1',
  sprintId: 'sprint-1',
  assigneeId: undefined,
  issueType: 'ALL',
  labels: [],
  searchTerm: '',
};

export const dashboardMockState: DashboardStateSnapshot = {
  projects: {
    'project-1': {
      id: 'project-1',
      name: 'MVP Backlog Ops',
      code: 'MVP',
      description: 'Flujo end-to-end para backlog inteligente',
      color: '#3b82f6',
      ownerId: 'user-1',
      epicIds: ['EP-1', 'EP-2'],
      issueIds: [
        'ST-101',
        'ST-102',
        'ST-103',
        'ST-104',
        'FE-201',
        'FE-202',
        'BE-301',
        'BE-302',
      ],
      sprintIds: ['sprint-1', 'sprint-2'],
    },
    'project-2': {
      id: 'project-2',
      name: 'IA Assistant',
      code: 'IA',
      description: 'Herramientas de IA para backlog y planificación',
      color: '#10b981',
      ownerId: 'user-1',
      epicIds: ['EP-3'],
      issueIds: ['ST-201', 'FE-401', 'BE-302'],
      sprintIds: ['sprint-3'],
    },
  },
  epics,
  issues,
  sprints,
  team,
  assignmentRules,
  activity,
};
